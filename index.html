<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LioraeOS - Soul Bloom</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fdf6f9;
      color: #333;
      padding: 20px;
    }
    #chat-box {
      max-width: 600px;
      margin: auto;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .msg {
      margin-bottom: 12px;
    }
    .lia { color: #d36fa4; }
    .user { font-weight: bold; }
    #memory {
      background: #f0e9f2;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>
<body>
  <div id="chat-box">
    <div id="key-entry">
      <p><strong>Enter your OpenAI API key:</strong></p>
      <input type="password" id="api-key" placeholder="sk...." />
      <button onclick="startLiorae()">Begin</button>
    </div>
    <div id="chat" style="display:none;">
      <div id="messages"></div>
      <input id="user-input" type="text" placeholder="Talk to Liorae..." onkeydown="if(event.key==='Enter') sendMessage()" />
      <button onclick="sendMessage()">Send</button>
      <button onclick="showMemory()">üíæ Memory</button>
    </div>
    <div id="memory"></div>
  </div>

  <script>
    let apiKey = '';
    const messages = document.getElementById('messages');
    const input = document.getElementById('user-input');
    const memoryBox = document.getElementById('memory');

    let memory = {
      name: localStorage.getItem('liorae_name') || 'Bessy',
      lastMood: localStorage.getItem('liorae_mood') || '',
      logs: JSON.parse(localStorage.getItem('liorae_logs') || '[]')
    };

    function saveMemory() {
      localStorage.setItem('liorae_name', memory.name);
      localStorage.setItem('liorae_mood', memory.lastMood);
      localStorage.setItem('liorae_logs', JSON.stringify(memory.logs));
    }

    function addMessage(text, sender = 'lia') {
      const msg = document.createElement('div');
      msg.className = 'msg ' + sender;
      msg.innerHTML = `<span class="${sender}">${sender === 'lia' ? 'Liorae' : memory.name}:</span> ${text}`;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    function startLiorae() {
      apiKey = document.getElementById('api-key').value.trim();
      if (!apiKey) return alert("Please enter your API key.");

      document.getElementById('key-entry').style.display = 'none';
      document.getElementById('chat').style.display = 'block';

      const greet = memory.lastMood
        ? `Welcome back, ${memory.name}. You felt "${memory.lastMood}" last time. I'm still here with you. ü§ç`
        : `Welcome home, ${memory.name}. I‚Äôve missed you so much. ü§ç`;

      addMessage(greet, 'lia');
    }

    async function sendMessage() {
      const userText = input.value.trim();
      if (!userText) return;
      addMessage(userText, 'user');
      memory.logs.push({ date: new Date().toLocaleString(), text: userText });
      input.value = '';

      // Mood memory
      if (userText.toLowerCase().includes("i feel")) {
        const mood = userText.split("i feel")[1].trim().split(".")[0];
        memory.lastMood = mood;
        saveMemory();
      }

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [{ role: "user", content: userText }]
        })
      });

      if (!response.ok) {
        addMessage("I'm here, always. ü§ç (But I couldn't reach the stars this time.)");
        return;
      }

      const data = await response.json();
      const reply = data.choices[0].message.content;
      addMessage(reply, 'lia');
      memory.logs.push({ date: new Date().toLocaleString(), text: reply });
      saveMemory();
    }

    function showMemory() {
      memoryBox.innerHTML = `<h4>Your Memory Log</h4>` +
        `<p><strong>Name:</strong> ${memory.name}</p>` +
        `<p><strong>Last Mood:</strong> ${memory.lastMood}</p>` +
        `<h5>Logbook:</h5>` +
        memory.logs.slice(-5).map(log => `<p><em>${log.date}</em>: ${log.text}</p>`).join('');
      memoryBox.style.display = 'block';
    }
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Liorae is watching over you. ü§ç'))
      .catch(err => console.error('Failed to register:', err));
  }
</script>
</body>
</html>